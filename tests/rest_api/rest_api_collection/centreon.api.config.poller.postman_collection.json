{
  "info": {
    "name": "Configure Poller",
    "_postman_id": "5abba33eb0937",
    "description": "Configure Poller",
    "schema": "https:\/\/schema.getpostman.com\/json\/collection\/v2.1.0\/collection.json"
  },
  "item": [{
    "name": "Authenticate",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["var jsonData = JSON.parse(responseBody);", "postman.setEnvironmentVariable(\"token\",jsonData.authToken);"]
      }
    }],
    "request": {
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=authenticate",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "key": "action",
          "value": "authenticate"
        }],
        "variable": []
      },
      "method": "POST",
      "header": [{
        "description": "",
        "key": "Content-Type",
        "value": "application\/x-www-form-urlencoded"
      }],
      "body": {
        "mode": "urlencoded",
        "urlencoded": [{
          "key": "username",
          "type": "text",
          "value": "{{api_user}}"
        }, {
          "key": "password",
          "type": "text",
          "value": "{{api_password}}"
        }]
      },
      "description": ""
    },
    "response": []
  }, {
    "name": "Add Instance",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;"]
      }
    }],
    "request": {
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "key": "action",
          "value": "action"
        }, {
          "key": "object",
          "value": "centreon_clapi"
        }],
        "variable": []
      },
      "method": "POST",
      "header": [{
        "description": "",
        "key": "Content-Type",
        "value": "application\/json"
      }, {
        "description": "",
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"add\",\n  \"object\": \"instance\",\n  \"values\": \"test_instance;01.02.3.04;42;nagios\"\n}"
      },
      "description": ""
    },
    "response": []
  }, {
    "name": "Setparam name",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;"]
      }
    }],
    "request": {
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "key": "action",
          "value": "action"
        }, {
          "key": "object",
          "value": "centreon_clapi"
        }],
        "variable": []
      },
      "method": "POST",
      "header": [{
        "description": "",
        "key": "Content-Type",
        "value": "application\/json"
      }, {
        "description": "",
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"setparam\",\n  \"object\": \"instance\",\n  \"values\": \"test_instance;name;{{instance_name}}\"\n}"
      },
      "description": ""
    },
    "response": []
  }, {
    "name": "Setparam localhost",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;"]
      }
    }],
    "request": {
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "key": "action",
          "value": "action"
        }, {
          "key": "object",
          "value": "centreon_clapi"
        }],
        "variable": []
      },
      "method": "POST",
      "header": [{
        "description": "",
        "key": "Content-Type",
        "value": "application\/json"
      }, {
        "description": "",
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"setparam\",\n  \"object\": \"instance\",\n  \"values\": \"{{instance_name}};localhost;{{instance_localhost}}\"\n}"
      },
      "description": ""
    },
    "response": []
  }, {
    "name": "Setparam ns_ip_address",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;"]
      }
    }],
    "request": {
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "key": "action",
          "value": "action"
        }, {
          "key": "object",
          "value": "centreon_clapi"
        }],
        "variable": []
      },
      "method": "POST",
      "header": [{
        "description": "",
        "key": "Content-Type",
        "value": "application\/json"
      }, {
        "description": "",
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"setparam\",\n  \"object\": \"instance\",\n  \"values\": \"{{instance_name}};ns_ip_address;{{instance_address}}\"\n}"
      },
      "description": ""
    },
    "response": []
  }, {
    "name": "Setparam ns_activate",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;"]
      }
    }],
    "request": {
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "key": "action",
          "value": "action"
        }, {
          "key": "object",
          "value": "centreon_clapi"
        }],
        "variable": []
      },
      "method": "POST",
      "header": [{
        "description": "",
        "key": "Content-Type",
        "value": "application\/json"
      }, {
        "description": "",
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"setparam\",\n  \"object\": \"instance\",\n  \"values\": \"{{instance_name}};ns_activate;{{instance_activate}}\"\n}"
      },
      "description": ""
    },
    "response": []
  }, {
    "name": "Setparam init_script",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;"]
      }
    }],
    "request": {
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "key": "action",
          "value": "action"
        }, {
          "key": "object",
          "value": "centreon_clapi"
        }],
        "variable": []
      },
      "method": "POST",
      "header": [{
        "description": "",
        "key": "Content-Type",
        "value": "application\/json"
      }, {
        "description": "",
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"setparam\",\n  \"object\": \"instance\",\n  \"values\": \"{{instance_name}};init_script;{{instance_init_script}}\"\n}"
      },
      "description": ""
    },
    "response": []
  }, {
    "name": "Setparam monitoring_engine",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;"]
      }
    }],
    "request": {
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "key": "action",
          "value": "action"
        }, {
          "key": "object",
          "value": "centreon_clapi"
        }],
        "variable": []
      },
      "method": "POST",
      "header": [{
        "description": "",
        "key": "Content-Type",
        "value": "application\/json"
      }, {
        "description": "",
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"setparam\",\n  \"object\": \"instance\",\n  \"values\": \"{{instance_name}};monitoring_engine;{{instance_monitoring_engine}}\"\n}"
      },
      "description": ""
    },
    "response": []
  }, {
    "name": "Setparam nagios_bin",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;"]
      }
    }],
    "request": {
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "key": "action",
          "value": "action"
        }, {
          "key": "object",
          "value": "centreon_clapi"
        }],
        "variable": []
      },
      "method": "POST",
      "header": [{
        "description": "",
        "key": "Content-Type",
        "value": "application\/json"
      }, {
        "description": "",
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"setparam\",\n  \"object\": \"instance\",\n  \"values\": \"{{instance_name}};nagios_bin;{{instance_nagios_bin}}\"\n}"
      },
      "description": ""
    },
    "response": []
  }, {
    "name": "Setparam nagiostats_bin",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;"]
      }
    }],
    "request": {
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "key": "action",
          "value": "action"
        }, {
          "key": "object",
          "value": "centreon_clapi"
        }],
        "variable": []
      },
      "method": "POST",
      "header": [{
        "description": "",
        "key": "Content-Type",
        "value": "application\/json"
      }, {
        "description": "",
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"setparam\",\n  \"object\": \"instance\",\n  \"values\": \"{{instance_name}};nagiostats_bin;{{instance_nagiostats_bin}}\"\n}"
      },
      "description": ""
    },
    "response": []
  }, {
    "name": "Setparam nagios_perfdata",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;"]
      }
    }],
    "request": {
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "key": "action",
          "value": "action"
        }, {
          "key": "object",
          "value": "centreon_clapi"
        }],
        "variable": []
      },
      "method": "POST",
      "header": [{
        "description": "",
        "key": "Content-Type",
        "value": "application\/json"
      }, {
        "description": "",
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"setparam\",\n  \"object\": \"instance\",\n  \"values\": \"{{instance_name}};nagios_perfdata;{{instance_nagios_perfdata}}\"\n}"
      },
      "description": ""
    },
    "response": []
  }, {
    "name": "Setparam ssh_port",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;"]
      }
    }],
    "request": {
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "key": "action",
          "value": "action"
        }, {
          "key": "object",
          "value": "centreon_clapi"
        }],
        "variable": []
      },
      "method": "POST",
      "header": [{
        "description": "",
        "key": "Content-Type",
        "value": "application\/json"
      }, {
        "description": "",
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"setparam\",\n  \"object\": \"instance\",\n  \"values\": \"{{instance_name}};ssh_port;{{instance_ssh_port}}\"\n}"
      },
      "description": ""
    },
    "response": []
  }, {
    "name": "Setparam centreonbroker_cfg_path",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;"]
      }
    }],
    "request": {
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "key": "action",
          "value": "action"
        }, {
          "key": "object",
          "value": "centreon_clapi"
        }],
        "variable": []
      },
      "method": "POST",
      "header": [{
        "description": "",
        "key": "Content-Type",
        "value": "application\/json"
      }, {
        "description": "",
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"setparam\",\n  \"object\": \"instance\",\n  \"values\": \"{{instance_name}};centreonbroker_cfg_path;{{instance_broker_cfg_path}}\"\n}"
      },
      "description": ""
    },
    "response": []
  }, {
    "name": "Setparam centreonbroker_module_path",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;"]
      }
    }],
    "request": {
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "key": "action",
          "value": "action"
        }, {
          "key": "object",
          "value": "centreon_clapi"
        }],
        "variable": []
      },
      "method": "POST",
      "header": [{
        "description": "",
        "key": "Content-Type",
        "value": "application\/json"
      }, {
        "description": "",
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"setparam\",\n  \"object\": \"instance\",\n  \"values\": \"{{instance_name}};centreonbroker_module_path;{{instance_broker_module_path}}\"\n}"
      },
      "description": ""
    },
    "response": []
  }, {
    "name": "List instances",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["var jsonData = JSON.parse(responseBody);",
          "var instanceData = jsonData.result;",
          "",
          "try {",
          "    tests[\"Body contains list of instances\"] = instanceData;",
          "    var i = 0;",
          "    while (i < instanceData.length) {",
          "        if (postman.getEnvironmentVariable(\"instance_name\") == instanceData[i].name) {",
          "            tests[\"Body contains added instance\"] = postman.getEnvironmentVariable(\"instance_name\") == instanceData[i].name;",
          "            tests[\"Body contains added instance_localhost\"] = postman.getEnvironmentVariable(\"instance_localhost\") == instanceData[i].localhost;",
          "            tests[\"Body contains added instance_address\"] = postman.getEnvironmentVariable(\"instance_address\") == instanceData[i]['ip address'];",
          "            tests[\"Body contains added instance_activate\"] = postman.getEnvironmentVariable(\"instance_activate\") == instanceData[i].activate;",
          "            tests[\"Body contains added instance_init_script\"] = postman.getEnvironmentVariable(\"instance_init_script\") == instanceData[i]['init script'];",
          "            tests[\"Body contains added instance_nagios_bin\"] = postman.getEnvironmentVariable(\"instance_nagios_bin\") == instanceData[i].bin;",
          "            tests[\"Body contains added instance_nagiostats_bin\"] = postman.getEnvironmentVariable(\"instance_nagiostats_bin\") == instanceData[i]['stats bin'];",
          "            tests[\"Body contains added instance_ssh_port\"] = postman.getEnvironmentVariable(\"instance_ssh_port\") == instanceData[i]['ssh port'];",
          "            break;",
          "        }",
          "        i++;",
          "    }",
          "    if (i == instanceData.length)",
          "        tests[\"instance_name was found\"] = false;",
          "} catch (e) {}",
          "",
          "tests[\"Status code is 200\"] = responseCode.code === 200;"]
      }
    }],
    "request": {
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "description": "",
          "equals": true,
          "key": "action",
          "value": "action"
        }, {
          "description": "",
          "equals": true,
          "key": "object",
          "value": "centreon_clapi"
        }],
        "variable": []
      },
      "method": "POST",
      "header": [{
        "description": "",
        "key": "Content-Type",
        "value": "application\/json"
      }, {
        "description": "",
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"show\",\n  \"object\": \"instance\"\n}"
      },
      "description": ""
    },
    "response": []
  }, {
    "name": "Create host2",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;"]
      }
    }],
    "request": {
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "key": "action",
          "value": "action",
          "equals": true,
          "description": ""
        }, {
          "key": "object",
          "value": "centreon_clapi",
          "equals": true,
          "description": ""
        }],
        "variable": []
      },
      "method": "POST",
      "header": [{
        "key": "Content-Type",
        "value": "application\/json",
        "description": ""
      }, {
        "key": "centreon-auth-token",
        "value": "{{token}}",
        "description": ""
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"add\",\n  \"object\": \"host\",\n  \"values\": \"{{host_name2}};{{host_name2}};0.0.0.0;;central;\"\n}"
      },
      "description": ""
    },
    "response": []
  }, {
    "name": "Create Instance-2",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;"]
      }
    }],
    "request": {
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "key": "action",
          "value": "action",
          "equals": true,
          "description": ""
        }, {
          "key": "object",
          "value": "centreon_clapi",
          "equals": true,
          "description": ""
        }],
        "variable": []
      },
      "method": "POST",
      "header": [{
        "key": "Content-Type",
        "value": "application\/json",
        "description": ""
      }, {
        "key": "centreon-auth-token",
        "value": "{{token}}",
        "description": ""
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"add\",\n  \"object\": \"instance\",\n  \"values\": \"{{instance_name2}};01.3.04.65;98;nagios\"\n}"
      },
      "description": ""
    },
    "response": []
  }, {
    "name": "Setinstance host",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;"]
      }
    }],
    "request": {
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "key": "action",
          "value": "action",
          "equals": true,
          "description": ""
        }, {
          "key": "object",
          "value": "centreon_clapi",
          "equals": true,
          "description": ""
        }],
        "variable": []
      },
      "method": "POST",
      "header": [{
        "key": "Content-Type",
        "value": "application\/json",
        "description": ""
      }, {
        "key": "centreon-auth-token",
        "value": "{{token}}",
        "description": ""
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"setinstance\",\n  \"object\": \"host\",\n  \"values\": \"{{host_name2}};{{instance_name}}\"\n}"
      },
      "description": ""
    },
    "response": []
  }, {
    "name": "Gethosts",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;",
          "",
          "var contentType = postman.getResponseHeader(\"Content-Type\");",
          "",
          "tests[\"Content-Type is present\"] = contentType !== null;",
          "tests[\"Content-Type is application\/json\"] = contentType === \"application\/json\";",
          "",
          "var jsonData = JSON.parse(responseBody);",
          "var hostData = jsonData.result;",
          "",
          "tests[\"Body contains entries\"] = hostData.length > 0;",
          "",
          "var schema = 0;",
          "if (hostData[0].id && hostData[0].name && hostData[0].address) {",
          "    schema = 1;",
          "}",
          "tests[\"Validate schema\"] = schema == 1;",
          "",
          "var pattern = \/^_Module_\/;",
          "var hostMetaPresent = false;",
          "var hostPresent = false;",
          "",
          "hostData.forEach(function(host) {",
          "    if (pattern.test(host.name) === true) {",
          "        hostMetaPresent = true;",
          "    }",
          "    ",
          "    if ((host.name == postman.getEnvironmentVariable(\"host_name2\")) && (host.address == \"0.0.0.0\")) {",
          "        hostPresent = true;",
          "    }",
          "});",
          "",
          "tests[\"Configured host present\"] = hostPresent === true;",
          "tests[\"No _Module host present\"] = hostMetaPresent === false;"]
      }
    }],
    "request": {
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "key": "action",
          "value": "action"
        }, {
          "key": "object",
          "value": "centreon_clapi"
        }],
        "variable": []
      },
      "method": "POST",
      "header": [{
        "description": "",
        "key": "Content-Type",
        "value": "application\/json"
      }, {
        "description": "",
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"gethosts\",\n  \"object\": \"instance\",\n  \"values\": \"{{instance_name}}\"\n}"
      },
      "description": ""
    },
    "response": []
  }]
}