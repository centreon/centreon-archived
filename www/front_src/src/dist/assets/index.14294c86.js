var t=Object.defineProperty,e=(e,r,s)=>(((e,r,s)=>{r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[r]=s})(e,"symbol"!=typeof r?r+"":r,s),s);import{r}from"./vendor.ecb5856a.js";import{n as s,a_ as a}from"./index.eda796bc.js";import{W as i}from"./index.bcbbb51c.js";import{B as n,P as o}from"./baseWizard.5f66a05d.js";import{r as m}from"./index.15eca6ad.js";import{b as u}from"./withTranslation.73eadfaa.js";import"./index.169497e9.js";import"./App.be5902de.js";import"./react-router-dom.a95a774c.js";import"./mapValues.3c657680.js";class p extends r.Component{constructor(){super(...arguments),e(this,"state",{generateStatus:null,error:null}),e(this,"links",[{active:!0,prevActive:!0,number:1},{active:!0,prevActive:!0,number:2},{active:!0,prevActive:!0,number:3},{active:!0,number:4}]),e(this,"generationTimeout",null),e(this,"remainingGenerationTimeout",30),e(this,"getExportTask",(()=>a("internal.php?object=centreon_task_service&action=getTaskStatus"))),e(this,"componentDidMount",(()=>{this.setGenerationTimeout()})),e(this,"setGenerationTimeout",(()=>{this.remainingGenerationTimeout>0?(this.remainingGenerationTimeout--,this.generationTimeout=setTimeout(this.refreshGeneration,1e3)):this.setState({generateStatus:!1,error:"Export generation timeout"})})),e(this,"refreshGeneration",(()=>{const{history:t}=this.props,{taskId:e}=this.props.pollerData;this.getExportTask().post("",{task_id:e}).then((e=>{!0!==e.data.success?this.setState({generateStatus:!1,error:JSON.stringify(e.data)}):"completed"===e.data.status?this.setState({generateStatus:!0},(()=>{setTimeout((()=>{t.push(m.pollerList)}),2e3)})):this.setGenerationTimeout()})).catch((t=>{this.setState({generateStatus:!1,error:JSON.stringify(t.response.data)})}))}))}render(){const{links:t}=this,{pollerData:e,t:s}=this.props,{generateStatus:a,error:m}=this.state;return r.createElement(n,null,r.createElement(o,{links:t}),r.createElement(i,{statusCreating:e.submitStatus,statusGenerating:a,formTitle:`${s("Finalizing Setup")}:`,error:m}))}}var l=u()(s((({pollerForm:t})=>({pollerData:t})),{})(p));export default l;
