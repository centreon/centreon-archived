var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,r=Object.getOwnPropertySymbols,a=Object.prototype.propertyIsEnumerable,s=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,o=(e,o)=>{for(var l in o||(o={}))t.call(o,l)&&s(e,l,o[l]);if(r)for(var l of r(o))a.call(o,l)&&s(e,l,o[l]);return e},l=(e,t,r)=>(s(e,"symbol"!=typeof t?t+"":t,r),r);import{r as i}from"./vendor.ecb5856a.js";import{n,a_ as m,bb as p}from"./index.eda796bc.js";import{i as c}from"./react-select.esm.a660ed61.js";import{s as d,B as h,P as u}from"./baseWizard.5f66a05d.js";import{S as b}from"./SelectField.b805a9da.js";import{C as f}from"./CheckboxField.c4cf3626.js";import{f as v}from"./hoc.a724f6b1.js";import{b as j}from"./withTranslation.73eadfaa.js";import{j as g,F as A,S as E}from"./reduxForm.9bd373e7.js";import{r as S}from"./index.15eca6ad.js";import"./memoize-one.esm.d1066b80.js";import"./utils.7b91ae49.js";import"./pick.70e729da.js";import"./mapValues.3c657680.js";import"./App.be5902de.js";import"./react-router-dom.a95a774c.js";class _ extends i.Component{constructor(){super(...arguments),l(this,"state",{selectedMaster:null,selectedAdditionals:[]}),l(this,"getAvailableAdditionals",(()=>{const{pollers:e}=this.props,{selectedMaster:t}=this.state;return e.filter((e=>{if(e.id!==t)return!0}))})),l(this,"handleChangeMaster",((e,t)=>{const{change:r}=this.props,{selectedAdditionals:a}=this.state,s=t?a.filter((e=>{if(e.value!==t)return!0})):[];r("linked_remote_slaves",s),this.setState({selectedMaster:t,selectedAdditionals:s})})),l(this,"handleChangeAdditionals",((e,t)=>{this.setState({selectedAdditionals:t})}))}render(){const{error:e,handleSubmit:t,onSubmit:r,pollers:a,t:s}=this.props,{selectedMaster:o}=this.state,l=this.getAvailableAdditionals();return i.createElement("div",{className:d["form-wrapper"]},i.createElement("div",{className:d["form-inner"]},i.createElement("form",{autoComplete:"off",onSubmit:t(r)},a.length?i.createElement(i.Fragment,null,i.createElement("h2",{className:d["form-title"]},s("Attach poller to a master remote server")),i.createElement(A,{name:"linked_remote_master",component:b,options:[{text:"",value:null}].concat(a.map((e=>({value:e.id,label:e.name,text:e.name})))),value:o,onChange:this.handleChangeMaster})):null,o&&a.length>=2?i.createElement(i.Fragment,null,i.createElement("h2",{className:d["form-title"]},s("Attach poller to additional remote servers")),i.createElement("div",{className:d["form-item"]},i.createElement(A,{name:"linked_remote_slaves",component:v(c),options:l.map((e=>({value:e.id,label:e.name}))),isMulti:!0,onChange:this.handleChangeAdditionals}))):null,i.createElement(A,{name:"open_broker_flow",component:f,label:s("Advanced: reverse Centreon Broker communication flow"),defaultValue:!1}),i.createElement("div",{className:d["form-buttons"]},i.createElement("button",{className:d.button,type:"submit"},s("Apply"))),e?i.createElement("div",{className:d["error-block"]},e.message):null)))}}var y=j()(g({form:"PollerFormStepTwo",enableReinitialize:!0,destroyOnUnmount:!1,keepDirtyOnReinitialize:!0})(_));class k extends i.Component{constructor(){super(...arguments),l(this,"state",{pollers:[]}),l(this,"links",[{active:!0,prevActive:!0,number:1,path:S.serverConfigurationWizard},{active:!0,prevActive:!0,number:2,path:S.pollerStep1},{active:!0,number:3},{active:!1,number:4}]),l(this,"pollerListApi",m("internal.php?object=centreon_configuration_remote&action=getRemotesList")),l(this,"wizardFormApi",m("internal.php?object=centreon_configuration_remote&action=linkCentreonRemoteServer")),l(this,"getPollers",(()=>{this.pollerListApi.post().then((e=>{this.setState({pollers:e.data})}))})),l(this,"componentDidMount",(()=>{this.getPollers()})),l(this,"handleSubmit",(e=>{const{history:t,pollerData:r,setPollerWizard:a}=this.props,s=o(o({},e),r);return s.server_type="poller",this.wizardFormApi.post("",s).then((e=>{a({submitStatus:e.data.success}),r.linked_remote_master?t.push(S.pollerStep3):t.push(S.pollerList)})).catch((e=>{throw new E({_error:new Error(e.response.data)})}))}))}render(){const{links:e}=this,{pollerData:t}=this.props,{pollers:r}=this.state;return i.createElement(h,null,i.createElement(u,{links:e}),i.createElement(y,{pollers:r,initialValues:t,onSubmit:this.handleSubmit.bind(this)}))}}var C=n((({pollerForm:e})=>({pollerData:e})),{setPollerWizard:p})(k);export default C;
