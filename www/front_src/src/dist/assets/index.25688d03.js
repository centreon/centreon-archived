var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,r=Object.getOwnPropertySymbols,a=Object.prototype.propertyIsEnumerable,s=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,o=(e,o)=>{for(var l in o||(o={}))t.call(o,l)&&s(e,l,o[l]);if(r)for(var l of r(o))a.call(o,l)&&s(e,l,o[l]);return e},l=(e,t,r)=>(s(e,"symbol"!=typeof t?t+"":t,r),r);import{r as i}from"./vendor.ecb5856a.js";import{n,a_ as m,bb as p}from"./index.eda796bc.js";import{i as c}from"./react-select.esm.a660ed61.js";import{s as u,B as d,P as h}from"./baseWizard.5f66a05d.js";import{f as b}from"./hoc.a724f6b1.js";import{b as f}from"./withTranslation.73eadfaa.js";import{j as v,F as S,S as j}from"./reduxForm.9bd373e7.js";import{r as y}from"./index.15eca6ad.js";import"./memoize-one.esm.d1066b80.js";import"./mapValues.3c657680.js";import"./App.be5902de.js";import"./react-router-dom.a95a774c.js";class g extends i.Component{constructor(){super(...arguments),l(this,"state",{value:[]}),l(this,"handleChange",((e,t)=>{this.setState({value:t})}))}render(){const{error:e,handleSubmit:t,onSubmit:r,pollers:a,t:s}=this.props,{value:o}=this.state;return i.createElement("div",{className:u["form-wrapper"]},i.createElement("div",{className:u["form-inner"]},i.createElement("div",{className:u["form-heading"]},i.createElement("h2",{className:u["form-title"]},s("Select pollers to be attached to this new Remote Server"))),i.createElement("form",{autoComplete:"off",onSubmit:t(r)},a?i.createElement(S,{name:"linked_pollers",component:b(c),label:`${s("Select linked Remote Server")}:`,options:a.items.map((e=>({value:e.id,label:e.text}))),value:o,onChange:this.handleChange,multi:!0,isMulti:!0}):null,i.createElement("div",{className:u["form-buttons"]},i.createElement("button",{className:u.button,type:"submit"},s("Apply"))),e?i.createElement("div",{className:u["error-block"]},e.message):null)))}}var E=f()(v({form:"RemoteServerFormStepTwo",enableReinitialize:!0,destroyOnUnmount:!1,keepDirtyOnReinitialize:!0})(g));class _ extends i.Component{constructor(){super(...arguments),l(this,"state",{pollers:null}),l(this,"links",[{active:!0,prevActive:!0,number:1,path:y.serverConfigurationWizard},{active:!0,prevActive:!0,number:2,path:y.remoteServerStep1},{active:!0,number:3},{active:!1,number:4}]),l(this,"pollerListApi",m("internal.php?object=centreon_configuration_poller&action=list")),l(this,"wizardFormApi",m("internal.php?object=centreon_configuration_remote&action=linkCentreonRemoteServer")),l(this,"_spliceOutDefaultPoller",(e=>{for(let t=0;t<e.items.length;t++)"1"===e.items[t].id&&e.items.splice(t,1);return e})),l(this,"_filterOutDefaultPoller",((e,t)=>{t(this._spliceOutDefaultPoller(e))})),l(this,"getPollers",(()=>{this.pollerListApi.get().then((e=>{this._filterOutDefaultPoller(e.data,(e=>{this.setState({pollers:e})}))}))})),l(this,"componentDidMount",(()=>{this.getPollers()})),l(this,"handleSubmit",(e=>{const{history:t,pollerData:r,setPollerWizard:a}=this.props,s=o(o({},e),r);return s.server_type="remote",this.wizardFormApi.post("",s).then((e=>{e.data.success&&e.data.task_id?(a({submitStatus:e.data.success,taskId:e.data.task_id}),t.push(y.remoteServerStep3)):t.push(y.pollerList)})).catch((e=>{throw new j({_error:new Error(e.response.data)})}))}))}render(){const{links:e}=this,{pollers:t}=this.state;return i.createElement(d,null,i.createElement(h,{links:e}),i.createElement(E,{pollers:t,onSubmit:this.handleSubmit}))}}var w=n((({pollerForm:e})=>({pollerData:e})),{setPollerWizard:p})(_);export default w;
