<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
    <head>
        <title>Centreon - IT & Network Monitoring</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="Generator" content="Centreon - Copyright (C) 2005 - 2021 Open Source Matters. All rights reserved." />
        <meta name="robots" content="index, nofollow" />
        <meta http-equiv="refresh" content="840">
        <link href="./Themes/Centreon-2/login.css" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="./img/favicon.ico">
        <script type="text/javascript" src="./include/common/javascript/jquery/jquery.min.js"></script>
    </head>
    <body OnLoad="document.login.useralias.focus();">
        <form action="./index.php" method="post" name="login" style="height:370px">
            {if $redirect != ''}
            <input type='hidden' value='{$redirect}' name='redirect'>
            {/if}
            <div class="login_wrapper">
                <div class="LoginInvitLogo">
                    <div class="error_msg" style="visibility: hidden">
                        <span class='msg'></span>
                    </div>
                   <img src="img/centreon.png" alt="Centreon Logo" title="Centreon Logo" />
                </div>
                <div class="logintab">
                    <table id="logintab1" style="text-align:center;" align="center">
                       {if $openIdConnectEnabled == 0 || ($openIdConnectEnabled == 1 && $openIdConnectMode == 1)}
                       <tr>
                            <td align='right'>{$form.useralias.label}</td>
                            <td>{$form.useralias.html}</td>
                        </tr>
                        <tr>
                            <td align='right'>{$form.password.label}</td>
                            <td>{$form.password.html}</td>
                        </tr>
                        <tr>
                            <td colspan="2" align='center'>{$form.submitLogin.html}</td>
                        </tr>
                        {/if}
                        {if $openIdConnectEnabled == 1}
                            <td colspan="2" align='center'><a href="?force=1"><input class="btc bt_info" name="submitLogin" value="Connect with OpenId Connect" type="button"/></a></td>
                        {/if}
                    </table>
                </div>
                <div class="LoginInvitVersion">
                    <span id="LoginInvitcpy">
                        &copy; <a href="mailto:contact@centreon.com">Centreon</a> 2005 - 2021
                    </span>
                    <br>
                    <span>
                        {$centreonVersion}
                    </span>
                </div>
            </div>
        {$form.hidden}
        </form>
        {literal}
        <script type="text/javascript">
            jQuery(() => {
                jQuery('form[name="login"]').submit(() => {
                    jQuery('input[type="submit"]').prop('disabled', true)
                    jQuery.ajax({
                        url: '/centreon/authentication/providers/configurations/local',
                        data: JSON.stringify({
                            login: jQuery('input[name="useralias"]').val(),
                            password: jQuery('input[name="password"]').val()
                        }),
                        method: 'POST',
                        contentType: 'application/json'
                    }).done((res) => {
                        window.location.href = res.redirect_uri
                    }).fail((err) => {
                        jQuery('span.msg').text('Your credentials are incorrect.')
                        jQuery('div.error_msg').css('visibility', '')
                    }).always(() => {
                        jQuery('input[type="submit"]').prop('disabled', false)
                    })
                    return false;
                });
            });
          // check :
          //  - if login page is in an iframe
          //  - if iframe url is login page with disconnect parameter
          if (window.location.href !== window.parent.location.href
            && window.location.href.match(/\/index.php\?disconnect=1/)
          ) {
            // send event to be manage by react app (redirect to login page)
            var event = new CustomEvent(
              'react.href.disconnect',
              {
                detail: {
                  href: window.location.href
                }
              }
            );
            window.parent.dispatchEvent(event);
          }
        </script>
        {/literal}
    </body>
</html>
